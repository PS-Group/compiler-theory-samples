# Минимальная поддержка динамических типов в интерпретаторе

Интерпретатор по-прежнему читает ввод построчно, строит AST и с его помощью выполняет инструкции.

С предыдущей итерации поддерживаются переменные, присваивания, печать выражений, управляющие инструкции `if`, `if .. else`, `while`, `do .. while`, пользовательские и встроенные функции, инструкция `return` и вызов функции, смена области видимости переменных внутри функции.

В данном примере добавлена минимальная поддержка типов данных:

- типы данных Boolean, Number, String (ранее всё считалось String)
- специальный тип даных Error для обработки ошибок времени выполнения
- бинарные операции над типами: арифметика для Number, сложение для String
- неявное преобразование Number и Boolean в String, String и Number в Boolean
- новые операторы `<`, `==`, которые возвращают Boolean или Error независимо от типов операндов
- поддержка строковых литералов и ключевых слов `true`, `false`.

##### Ввод
```
def sqr(x)
  result = x * x
  return result
end
print sqr("10")
print sqr(10)
flag = 10 < 20
if flag
  print flag
end
```

##### Вывод
```
  Error: Cannot use '*' with String values.
  Error: unknown variable result
  100.000000
  true
```

### Изменения в сравнении с lemon-7-functions

Новые классы:

- CValue реализует значение, тип которого определяется динамически, но принадлежит диапазону типов `String, Number, Boolean, Error`.
- Обработка ошибок времени выполнения, в том числе проверка аргументов функций, претерпела сильные изменения
- В классе `CBatchParser` появился метод `GetStringLiteral` для получения значения литерала по ID строки в объекте класса `CStringPool`.

Новые правила в грамматике:

- оператор "меньше": `expression(X) ::= expression(A) LESS expression(B).`
- оператор "равно": `expression(X) ::= expression(A) EQUALS expression(B).`
- строковый литерал как выражение: `expression(X) ::= STRING(A).`
- булево `true` или `false` как выражение: `expression(X) ::= BOOL(A).`
- приоритет "меньше" и "равно" наименьший в сравнении с остальными:
```
%left LESS EQUALS.
%left PLUS MINUS.
%left STAR SLASH PERCENT.
```

### Системные требования

- Для ОС Ubuntu: установите пакет `lemon`
- Для ОС Windows: соберите Lemon из [исходных кодов (hwaci.com)](http://www.hwaci.com/sw/lemon/). Исходники Lemon состоят всего из двух файлов, `lemon.c` и `lempar.c`. Используйте любой современный компилятор C/C++.
